Лабораторная работа №3: Анализ поведения пользователей мобильного приложения
Вариант задания №14: Анализ метрик пользовательского поведения
Бизнес-задача: Анализ эффективности вовлечения новых пользователей
Описание проблемы
Компания-разработчик мобильного приложения нуждается в автоматизированном анализе поведения новых пользователей. Ключевыми метриками являются среднее время сессии и средний чек для пользователей, зарегистрированных в последнем месяце.

Бизнес-ценность решения

📊 Мониторинг вовлеченности - отслеживание активности новых пользователей

💰 Анализ монетизации - оценка эффективности стратегии monetization

🎯 Выявление проблем - быстрое определение падения ключевых метрик

📈 Data-driven решения - принятие решений на основе объективных данных

⏰ Автоматизация отчетности - ежедневный расчет без участия аналитика

Архитектура решения
Схема ETL-процесса
text
                    EXTRACT PHASE (Параллельно)
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ extract_users   │  │ extract_sessions│  │ extract_purchases│
│                 │  │                 │  │                 │
│ users.csv       │  │ sessions.xlsx   │  │ purchases.json  │
│ ┌─────────────┐ │  │ ┌─────────────┐ │  │ ┌─────────────┐ │
│ │user_id      │ │  │ │user_id      │ │  │ │user_id      │ │
│ │registration │ │  │ │session_     │ │  │ │purchase_    │ │
│ │_date        │ │  │ │duration     │ │  │ │amount       │ │
│ └─────────────┘ │  │ └─────────────┘ │  │ └─────────────┘ │
└─────────────────┘  └─────────────────┘  └─────────────────┘
         │                     │                     │
         └─────────────────────┼─────────────────────┘
                               │
                    TRANSFORM PHASE
                ┌─────────────────┐
                │ transform_data  │
                │                 │
                │ 1. Фильтрация   │
                │    новых users  │
                │ 2. Расчет       │
                │    среднего     │
                │    времени      │
                │    сессии       │
                │ 3. Расчет       │
                │    среднего     │
                │    чека         │
                └─────────────────┘
                         │
                    LOAD PHASE
                ┌─────────────────┐
                │load_to_database │
                │                 │
                │ SQLite DB       │
                │ user_behavior   │
                │ table           │
                └─────────────────┘
                         │
                 REPORTING PHASE
                ┌─────────────────┐
                │generate_report  │
                │                 │
                │ TXT Report      │
                │ CSV Data Export │
                └─────────────────┘
                         │
               NOTIFICATION PHASE
                ┌─────────────────┐
                │send_email       │
                │                 │
                │ HTML Email +    │
                │ File Attachments│
                └─────────────────┘
Исходные данные
Файл 1: users.csv - Данные о пользователях
csv
user_id,registration_date
1,2024-09-15
2,2024-09-20
3,2024-08-25
...
Файл 2: sessions.xlsx - Данные о сессиях
user_id	session_duration_minutes
1	15
1	25
2	30
...	...
Файл 3: purchases.json - Данные о покупках
json
[
  {"user_id": 1, "purchase_amount": 1200},
  {"user_id": 2, "purchase_amount": 800},
  ...
]
Расчетные метрики
Основные метрики:
Среднее время сессии = Σ(время сессий) / количество сессий

Средний чек = Σ(суммы покупок) / количество покупок

Конверсия = (платящие пользователи / все пользователи) × 100%

Дополнительные метрики:
Общая выручка

Количество новых пользователей

Количество платящих пользователей

Общее количество покупок

Технический стек
Компонент	Технология	Назначение
Оркестрация	Apache Airflow 2.5.0	Управление ETL-процессами
Контейнеризация	Docker + Docker Compose	Изоляция и развертывание
База данных	PostgreSQL 12 + SQLite	Метаданные + результаты
Обработка данных	Python 3.8 + Pandas	ETL-логика и трансформации
Работа с Excel	openpyxl	Чтение Excel файлов
Email-уведомления	MailHog	Тестирование email-рассылок
Веб-интерфейс	Airflow WebUI	Мониторинг и управление
Структура проекта
text
lw_03/
├── dags/
│   ├── data/                          # Исходные данные
│   │   ├── users.csv                  # Пользователи и даты регистрации
│   │   ├── sessions.xlsx              # Данные о сессиях
│   │   └── purchases.json             # Данные о покупках
│   └── user_behavior_analysis_dag.py  # DAG для варианта №14 ⭐
├── docker-compose.yml                 # Конфигурация Docker Compose
├── requirements.txt                   # Зависимости Python
├── check_results.py                   # Скрипт проверки результатов
├── cleanup.sh                         # Скрипт полной очистки
└── README.md                          # Данная инструкция
Пошаговая инструкция запуска
Шаг 1: Подготовка окружения
bash
# Клонирование проекта (если нужно)
git clone <repository-url>
cd lw_03

# Запуск всех сервисов
sudo docker compose up -d

# Проверка статуса контейнеров
sudo docker ps
Ожидаемый результат: 4 контейнера в статусе Up:

lw_03-webserver-1

lw_03-scheduler-1

lw_03-postgres-1

lw_03-mailhog-1

Шаг 2: Доступ к веб-интерфейсам
Airflow UI: http://localhost:8081

Логин: admin

Пароль: admin

MailHog UI: http://localhost:8026

Шаг 3: Работа с Apache Airflow
В Airflow UI выполните:
Найдите DAG user_behavior_analysis в списке

Активируйте DAG (переключатель слева)

Запустите вручную - кнопка "Trigger DAG" (▶️)

Мониторьте выполнение через Graph View

Статусы задач:
🟢 Success - задача выполнена успешно

🔴 Failed - ошибка выполнения

🟡 Running - выполняется

⚪ Queued - в очереди

Шаг 4: Проверка email-уведомлений
После успешного выполнения DAG проверьте MailHog:

Откройте http://localhost:8026

Найдите письмо от airflow@example.com

Тема: "Анализ поведения пользователей мобильного приложения - Результаты"

В письме будут прикреплены файлы результатов

Шаг 5: Проверка результатов
bash
# Проверка результатов в базе данных
python3 check_results.py

# Копирование файлов результатов из контейнера
python3 check_results.py --files
Описание задач DAG
1. Extract задачи (параллельные)
extract_users - чтение CSV с данными пользователей

extract_sessions - чтение Excel с данными сессий

extract_purchases - чтение JSON с данными покупок

2. Transform задача
transform_data - основная логика анализа:

Фильтрация пользователей по дате регистрации

Расчет среднего времени сессии

Расчет среднего чека

Расчет конверсии и других метрик

3. Load задача
load_to_database - сохранение результатов в SQLite

4. Reporting задача
generate_report - генерация текстового отчета и CSV

5. Notification задача
send_email - отправка email с результатами

Пример результатов анализа
text
ОТЧЕТ ПО АНАЛИЗУ ПОВЕДЕНИЯ ПОЛЬЗОВАТЕЛЕЙ МОБИЛЬНОГО ПРИЛОЖЕНИЯ
=======================================================================

Дата анализа: 2024-10-02 15:30:45
Период анализа: пользователи, зарегистрированные за последние 30 дней

КЛЮЧЕВЫЕ МЕТРИКИ:
------------------
• Количество новых пользователей: 7
• Среднее время сессии: 28.5 минут
• Средний чек: 1,185.71 руб.
• Конверсия в покупку: 57.14%

ДЕТАЛЬНЫЕ РЕЗУЛЬТАТЫ:
---------------------
- Среднее время сессии (минуты): 28.5
- Средний чек (рубли): 1185.71
- Общая выручка (рубли): 8300.0
- Всего новых пользователей: 7
- Платящих пользователей: 4
- Всего покупок: 7
- Конверсия (%): 57.14

АНАЛИТИЧЕСКИЕ ВЫВОДЫ И РЕКОМЕНДАЦИИ:
------------------------------------
✓ Высокое время сессии - пользователи активно используют приложение
✓ Отличная конверсия в покупку - эффективная монетизация
✓ Высокий средний чек - ценности продукта соответствует цене
Команды управления
Основные команды:
bash
# Запуск сервисов
sudo docker compose up -d

# Остановка сервисов
sudo docker compose down

# Просмотр логов
sudo docker logs lw_03-scheduler-1 --follow

# Полная очистка
sudo ./cleanup.sh
Полезные команды для отладки:
bash
# Проверить занятость портов
sudo netstat -tulpn | grep -E ':(5433|8081|8026)'

# Зайти в контейнер scheduler
sudo docker exec -it lw_03-scheduler-1 bash

# Проверить базу данных
sqlite3 /opt/airflow/user_behavior.db "SELECT * FROM user_behavior_analysis;"
Устранение неполадок
Проблема: Порт уже занят
Решение: Используются альтернативные порты:

Airflow: 8081 вместо 8080

MailHog: 8026 вместо 8025

PostgreSQL: 5433 вместо 5432

Проблема: DAG не появляется в интерфейсе
Решение: Проверьте логи scheduler:

bash
sudo docker logs lw_03-scheduler-1 | grep -i error
Проблема: Ошибки в задачах
Решение: Просмотрите логи конкретной задачи в Airflow UI

Бизнес-интерпретация результатов
Хорошие показатели:
Время сессии > 20 мин - высокая вовлеченность

Конверсия > 10% - эффективная монетизация

Средний чек > 1000 руб - хорошая ценность продукта

Плохие показатели:
Время сессии < 10 мин - низкая вовлеченность

Конверсия < 5% - проблемы с воронкой продаж

Средний чек < 500 руб - низкая ценность предложения

Выводы
Технические достижения:
✅ Реализован полный ETL-процесс в Apache Airflow

✅ Автоматизирован анализ пользовательского поведения

✅ Настроены email-уведомления с результатами

✅ Обеспечена обработка разноформатных данных (CSV, Excel, JSON)

Бизнес-результаты:
📊 Автоматизирован расчет ключевых метрик поведения пользователей

📈 Создана система мониторинга эффективности привлечения пользователей

💰 Реализован анализ монетизации и конверсии

🔍 Выявлены закономерности в поведении новых пользователей

Практические навыки:
Проектирование DAG в Apache Airflow

Работа с Docker Compose для оркестрации сервисов

Обработка данных с помощью Pandas

Настройка email-уведомлений и мониторинга

Работа с различными форматами данных

Проект готов к использованию в production-среде и может быть легко расширен для работы с реальными источниками данных.